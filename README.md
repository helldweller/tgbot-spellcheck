# tgbot-spellcheck

Production-ready каркас Telegram-бота на Go для проверки орфографии и грамматики в постах каналов.

## Возможности

- Добавляется в канал как администратор и отслеживает новые посты.
- Для каждого нового поста:
  - Оборачивает текст в prompt для коррекции.
  - Отправляет запрос в OpenAI Chat Completions API.
  - Публикует исправленный текст и удаляет исходный.
- Не повторно обрабатывает:
  - сообщения, созданные ботами;
  - уже помеченные специальной меткой;
  - message_id, сохранённые в хранилище (in-memory, легко заменить на Redis/Postgres).
- Ограничение частоты: не более одного обработанного поста за настраиваемый интервал.
- При достижении лимита отправляет в канал уведомление вместо обработки.
- Итоговые сообщения помечаются скрытым HTML-комментарием `<!--spellchecked-->`.
- Конфигурация через переменные окружения.
- Graceful shutdown, логирование, таймауты и простые ретраи для OpenAI.

## Переменные окружения

- `TELEGRAM_BOT_TOKEN` — токен Telegram-бота.
- `OPENAI_API_KEY` — API-ключ OpenAI.
- `TELEGRAM_CHANNEL_ID` — numeric ID канала (например, `-1001234567890`).
- `MIN_INTERVAL_SECONDS` — минимальный интервал между полными обработками постов (по умолчанию 600, т.е. 10 минут).
- `OPENAI_MODEL` — (опционально) модель OpenAI, по умолчанию `gpt-4.1-mini`.

## Запуск локально

```bash
export TELEGRAM_BOT_TOKEN="..."
export OPENAI_API_KEY="..."
export TELEGRAM_CHANNEL_ID="-1001234567890"
export MIN_INTERVAL_SECONDS="600"

# установка зависимостей
go get ./...

# запуск
go run ./cmd/bot
```

Убедитесь, что бот добавлен в канал как администратор с правами на удаление сообщений и публикацию новых.

## Дальнейшее развитие

- Вынести хранилище в Redis/Postgres.
- Добавить поддержку вебхуков вместо long-polling.
- Тонкая настройка prompt-а и поведения для разных языков и каналов.
